# 5) 사용자 플로우 (End-user / Viewer 관점)

## 개요

사용자(뷰어) 플로우는 공유된 링크를 클릭한 최종 사용자가 콘텐츠를 보고 리드를 제출하는 과정을 설명한다. 다양한 시나리오와 엣지 케이스를 포함하여 실제 사용자 경험을 상세히 정의한다.

---

## Flow A: 링크 클릭 → 일부 블라인드 → 제출 → 해제 → 재방문 유지

### 단계별 상세 설명

#### Step 1: 링크 클릭
- **트리거**: 사용자가 인스타/링크드인/댓글/DM의 링크 클릭
- **컨텍스트**: 
  - 세일즈 담당자가 보낸 템플릿 링크
  - 마케터가 공유한 가이드 링크
  - 크리에이터가 올린 자료 링크
- **기대**: 사용자는 "무엇인가 유용한 콘텐츠"를 기대

#### Step 2: 서비스 화면 즉시 열림
- **랜딩페이지 없음**: 별도 랜딩 페이지 없이 바로 콘텐츠 화면으로 이동
- **로딩 상태**: 
  - 초기 로딩 스피너 표시 (1-2초)
  - Notion 콘텐츠 로딩 중임을 표시
- **브랜딩**: 우측 하단에 FORMTION 로고 버튼 표시 (북마크 디자인)

#### Step 3: Notion 콘텐츠 렌더링
- **임베드**: Notion 공개 공유 링크가 iframe으로 임베드됨
- **로딩 완료**: 콘텐츠가 정상적으로 표시됨
- **초기 상태**: 
  - 설정된 블라인드가 적용된 상태
  - 설정된 UX 패턴에 따라 폼/CTA가 노출됨

#### Step 4: UX 패턴에 따른 폼/CTA 노출
운영자가 설정한 UX 패턴에 따라 다른 경험:

**패턴별 노출 방식:**

1. **Top Form이 ON인 경우**:
   - 콘텐츠 상단에 폼 영역 표시
   - Title/Sub-title이 설정된 메시지 표시
   - 사용자는 폼을 먼저 보게 됨

2. **Entry Modal이 ON인 경우**:
   - 페이지 로드 완료 후 즉시 모달 표시
   - 배경이 어둡게 처리됨
   - 모달 내에 폼 표시
   - 닫기 허용 여부에 따라 X 버튼 표시 여부 결정

3. **Floating CTA가 ON인 경우**:
   - 우측 하단에 CTA 버튼 표시
   - 사용자는 콘텐츠를 자유롭게 읽을 수 있음
   - 버튼 클릭 시 Drawer/Modal 오픈

4. **Inline Blur Gate가 ON인 경우**:
   - 콘텐츠를 읽다가 블러 구간에 도달하면 인라인 카드 표시
   - 블러 처리된 부분이 보임
   - 카드 내에 폼 표시

#### Step 5: 사용자가 폼에 입력
- **필수 필드**: 이메일 (반드시 입력)
- **선택 필드**: 이름, 회사명, 직무, 한 줄 질문 등 (운영자 설정에 따라)
- **동의 옵션**: 
  - 개인정보 처리 동의 (필수 또는 선택, 운영자 설정)
  - 마케팅 수신 동의 (선택, 기본 OFF)
- **유효성 검사**: 
  - 이메일 형식 검사
  - 필수 필드 검사
  - 실시간 피드백 제공

#### Step 6: 폼 제출
- **제출 버튼**: "Unlock", "Unlock & Continue" 등
- **제출 처리**:
  - 로딩 스피너 표시
  - API 호출 (POST /leads)
  - 네트워크 오류 시 재시도 (최대 2회)

#### Step 7: 제출 성공 시
- **블라인드 해제**:
  - 블러 효과가 사라짐 (애니메이션 효과)
  - 콘텐츠가 선명하게 표시됨
  - Inline Blur Gate의 경우 인라인 카드 제거 또는 축소
- **성공 메시지**:
  - 토스트 메시지 표시: "Unlocked. 계속 읽어보세요."
  - 또는 작은 배지: "Unlocked"
- **상태 저장**:
  - localStorage에 `unlocked_{project_id}: true` 저장
  - 쿠키에도 저장 (localStorage 실패 시 대비)
  - 만료 시간: 운영자 설정 (기본 30일)
  - 타임스탬프 저장: `unlocked_at_{project_id}: timestamp`
- **폼 처리**:
  - Entry Modal: 모달 닫기
  - Top/Bottom Form: 폼 유지 또는 숨김 (운영자 설정, 기본은 유지하되 "Unlocked" 표시)
  - Floating CTA: 버튼 유지하되 "Unlocked" 배지 또는 숨김
  - Inline Blur Gate: 인라인 카드 제거

#### Step 8: 재방문 시
- **상태 확인**:
  - localStorage 또는 쿠키에서 `unlocked_{project_id}` 확인
  - 만료 시간 확인 (기본 30일)
- **동작**:
  - unlocked 상태이면:
    - 블라인드 제거 (이미 해제된 상태)
    - 폼/모달 숨김 (기본 동작)
    - 상단 작은 배지 표시 (선택): "Unlocked on this device"
  - 만료되었거나 unlocked 상태가 아니면:
    - 처음 방문과 동일하게 처리

---

## Flow B: 제출 없이 읽기

### 시나리오 설명
사용자가 폼을 제출하지 않고 콘텐츠를 읽으려는 경우

### 운영자 설정에 따른 동작

#### B-1: Entry Modal에서 "닫기 허용"이 ON인 경우
1. 모달이 표시됨
2. 사용자가 "Not now" 또는 X 버튼 클릭
3. 모달이 닫힘
4. 콘텐츠 일부를 볼 수 있으나, 블라인드 구간은 여전히 블러 처리됨
5. 사용자는 블라인드 구간에 도달하면:
   - Inline Blur Gate가 있으면 인라인 카드 표시
   - Top/Bottom Form이 있으면 폼 표시
   - Floating CTA가 있으면 버튼 클릭 유도
6. 결국 폼을 제출하지 않으면 블라인드 구간을 볼 수 없음

#### B-2: Entry Modal에서 "닫기 허용"이 OFF인 경우
1. 모달이 표시됨
2. 닫기 버튼이 없음
3. 사용자는 폼을 제출하기 전까지 모달을 닫을 수 없음
4. 콘텐츠를 보려면 반드시 폼 제출해야 함

#### B-3: Inline Blur Gate만 있는 경우
1. 콘텐츠를 읽다가 블러 구간에 도달
2. 블러 처리된 부분을 볼 수 없음
3. 인라인 카드에 폼 표시
4. 폼을 제출하지 않으면 더 이상 진행할 수 없음
5. 스크롤은 가능하지만 블러 구간은 계속 블러 처리됨

#### B-4: Floating CTA만 있는 경우
1. 콘텐츠를 자유롭게 읽을 수 있음
2. 블러 구간도 볼 수 있으나 블러 처리됨
3. 우측 하단 CTA 버튼 클릭 시 폼 표시
4. 사용자는 선택적으로 폼을 제출할 수 있음
5. 폼을 제출하지 않으면 블러 구간은 계속 블러 처리됨

---

## Flow C: 모바일 환경

### 모바일 특화 고려사항

#### C-1: 레이아웃 조정
- **폼 크기**: 모바일 화면에 맞게 전체 너비 사용
- **패딩**: 충분한 터치 영역 확보 (최소 44px)
- **폰트 크기**: 가독성을 위해 적절한 크기 유지 (최소 16px)

#### C-2: Floating CTA 버튼
- **위치**: 하단 고정 (PC는 우측 하단)
- **크기**: 터치하기 쉬운 크기 (최소 44x44px)
- **스타일**: 모바일에서는 전체 너비 버튼 형태도 고려

#### C-3: Modal vs Drawer
- **Modal**: 작은 화면에서는 전체 화면 모달 사용
- **Drawer (권장)**: 하단에서 슬라이드 업하는 Drawer 형태가 더 자연스러움
- **스와이프 제스처**: Drawer를 아래로 스와이프하여 닫기 (닫기 허용 시)

#### C-4: 키보드 처리
- **키보드 오픈 시**: 
  - 폼 필드에 포커스 시 키보드가 올라옴
  - 레이아웃이 키보드에 가려지지 않도록 스크롤 조정
  - 모달/Drawer 위치 조정
- **키보드 닫기**: 
  - 다른 영역 터치 시 키보드 닫힘
  - 제출 버튼 클릭 시 키보드 닫힘

#### C-5: 터치 최적화
- **버튼 크기**: 모든 클릭 가능한 요소는 최소 44x44px
- **간격**: 버튼 간 충분한 간격 유지 (오탭 방지)
- **스크롤**: 부드러운 스크롤, 스크롤 중에도 CTA 버튼은 고정

#### C-6: 성능
- **로딩**: 모바일 네트워크 고려하여 로딩 최적화
- **이미지**: 필요 시 lazy loading
- **애니메이션**: 부드러운 60fps 애니메이션

---

## Flow D: 에러 처리 플로우

### D-1: 네트워크 오류
1. 폼 제출 시도
2. 네트워크 오류 발생
3. 에러 메시지 표시: "네트워크가 불안정해요. 한 번만 더."
4. 재시도 버튼 표시
5. 최대 2회 재시도
6. 계속 실패 시: "잠시 후 다시 시도해 주세요" 메시지

### D-2: 서버 오류
1. 폼 제출 시도
2. 서버 오류 (500 등) 발생
3. 에러 메시지 표시: "잠시 오류가 있었어요. 다시 시도해 주세요."
4. 재시도 버튼 표시

### D-3: 유효성 검사 오류
1. 폼 제출 시도
2. 필수 필드 미입력 또는 형식 오류
3. 실시간 피드백:
   - 해당 필드 아래 에러 메시지 표시
   - 필드 테두리를 빨간색으로 변경
   - 스크롤하여 해당 필드로 이동

### D-4: 중복 제출 방지
1. 폼 제출 버튼 클릭
2. 즉시 버튼 비활성화 ("제출 중...")
3. 제출 완료까지 버튼 비활성화 유지
4. 제출 완료 후 버튼 상태 복원

---

## Flow E: 재방문 플로우 (상세)

### E-1: 같은 브라우저, 같은 디바이스
1. 사용자가 링크 클릭
2. 브라우저가 localStorage/쿠키 확인
3. `unlocked_{project_id}`가 `true`이고 만료되지 않았으면:
   - 블라인드 해제 상태로 표시
   - 폼/모달 숨김
   - 작은 배지 표시 (선택): "Unlocked on this device"
4. 만료되었으면:
   - 처음 방문과 동일하게 처리

### E-2: 다른 브라우저 또는 다른 디바이스
1. 사용자가 링크 클릭
2. localStorage/쿠키가 없음 (또는 다른 디바이스)
3. 처음 방문과 동일하게 처리
4. 폼을 다시 제출해야 함

### E-3: 시크릿 모드/프라이빗 브라우징
1. 사용자가 시크릿 모드에서 링크 클릭
2. localStorage/쿠키 저장이 제한될 수 있음
3. 가능한 경우 저장 시도
4. 실패 시 세션 기반으로만 유지 (브라우저 닫으면 해제)

---

## Flow F: 다양한 UX 패턴 조합 플로우

### F-1: Entry Modal + Inline Blur Gate
1. 페이지 진입 → Entry Modal 표시
2. 사용자가 폼 제출 → 모달 닫힘, 블라인드 해제
3. 사용자가 콘텐츠를 읽다가 Inline Blur Gate 구간 도달
4. 이미 unlocked 상태이므로 블러가 해제된 상태로 표시
5. (또는 운영자 설정에 따라 Inline Blur Gate가 별도로 작동할 수도 있음)

### F-2: Top Form + Bottom Form
1. 페이지 진입 → 상단 폼 표시
2. 사용자가 상단 폼 제출 → 블라인드 해제, 상단 폼 "Unlocked" 표시
3. 사용자가 콘텐츠를 읽음
4. 하단 폼도 표시 (이미 unlocked이므로 "구독" 또는 "더 많은 정보" 형태로 변경 가능)

### F-3: Floating CTA만
1. 페이지 진입 → 콘텐츠와 블러 표시, 우측 하단 CTA 버튼 표시
2. 사용자가 콘텐츠를 자유롭게 읽음
3. 사용자가 CTA 버튼 클릭 → Drawer/Modal 오픈, 폼 표시
4. 사용자가 폼 제출 → 블라인드 해제, CTA 버튼 "Unlocked" 배지 표시

---

## 사용자 여정 다이어그램 (참고)

```
[링크 클릭]
    ↓
[페이지 로드]
    ↓
[Notion 콘텐츠 렌더링]
    ↓
[UX 패턴에 따라 폼/CTA 노출]
    ↓
┌─────────────────┬─────────────────┐
│  폼 제출        │  제출 안 함     │
│  (Flow A)       │  (Flow B)       │
└─────────────────┴─────────────────┘
    ↓                    ↓
[블라인드 해제]    [블라인드 유지]
    ↓                    ↓
[상태 저장]        [제한된 콘텐츠]
    ↓
[재방문 시]
    ↓
[상태 확인]
    ↓
┌─────────┬─────────┐
│Unlocked │Not Lock │
└─────────┴─────────┘
```

---

## 접근성 고려사항

### 키보드 네비게이션
- Tab 키로 모든 폼 필드와 버튼 이동 가능
- Enter 키로 폼 제출
- Esc 키로 모달 닫기 (닫기 허용 시)

### 스크린 리더
- 모든 폼 필드에 적절한 라벨 제공
- 에러 메시지를 스크린 리더가 읽을 수 있도록
- 모달의 경우 focus trap 처리

### 색상 대비
- WCAG AA 기준 준수 (최소 4.5:1 대비율)
- 색상만으로 정보를 전달하지 않음 (아이콘/텍스트 병행)


